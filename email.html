<!DOCTYPE html>
<html lang="en">
<head>
    <title>email client interface</title>
    <!-- style sheets -->
   <link rel="stylesheet" type="text/css" href="header.css">
   <link rel="stylesheet" type="text/css" href="email_content.css">
   <link rel="stylesheet" type="text/css" href="dir.css">

    <!-- use jQuery from Google  -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- use jQuery from Google-->
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.min.js"></script>
    <!-- jQuery functions in a separate .js file.  -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- icon library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> 
    
</head>
<body>

<!-- code for the header -->
<div class="mainDiv">
<!-- Header -->
    <div class="topNav">
        <div class=Icon_label>
          <img src="images/logo.png" alt="FINDMAIL_ICON" width="40" height="40" id="logo" > 
           <p  font size="80">
                  <span style='color: blue'><em>F</em></span>
                  <span style='color: red'><em>I</em></span>
                  <span style='color: green'><em>N</em></span>
                  <span style='color: blue'><em>D</em></span>
                  <span style='color: green'><em>M</em></span>
                  <span style='color: red'><em>A</em></span>
                  <span style='color: red'><em>I</em></span>
                  <span style='color: red'><em>L</em></span>

                   </p>
        </div>
           <!--put the menu buttons here-->
        <div class="btn-group" id="btn-group">
<!--
                <button id="All" class="dir">All</button>
                <button id="Sent" class="dir">Inbox</button>
                <button id="Sent" class="dir">Sent</button>
                <button id="Trash" class="dir">Trash</button>
-->
        </div>
          
    </div>
    <div class="sideNav">
        <div class="searchRow">
            <form action="hello.py">
                <input type="text" placeholder="Search.." name="search">
            </form>
            <button onclick="myFunction()" class="dropbtn"><i class="fa fa-search"></i></button>
        </div>
        <ul id="dynamic-list">
                 
         </ul>
        
    </div>
    <div class="emails">
        <div class="settings"> 
            <button onclick="myFunction()" ><i class="fa fa-cog"></i></button>
        </div>
            
            <div class="content" id="content">
                
            </div>
    </div>


</div>
<!--put the menu buttons here and actaul emails--> 

<!--read the file -->

<script>
var myArr;
var myMap = new Map();  // used for subdirectories
function loadDoc(file) {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        myArr=this.responseText.split("\n");
        console.log(myArr[0]);
        var i=0;
        for (i=0;i<myArr.length;i++)
            {
              readAdd(myArr[i]); 
            }
    }
  };
  xhttp.open("GET",file ,true);
  xhttp.send();
}
var json_dir;
var jsonData;
function addDir(path_dir)
    {  var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
        var count=0;
        var  rootDir;
        var json_dir=JSON.parse(this.responseText);
        for (var key in json_dir)
        {
            if (json_dir.hasOwnProperty(key)) 
            {   //console.log(key);
                if (count==0)
                    {  rootDir=json_dir[key]; // has all the root directories
                        count++;
                    }
            
            }      
        } 
        // add to the  map
      var m=0;
      jsonData=json_dir;
    for (m=0;m<rootDir.length;m++)
        {  //console.log("it should work");
        
          addMap(rootDir[m]);  
            
        }
            

    }
  }
  xhttp.overrideMimeType("application/json");
  xhttp.open("GET",path_dir ,false);
  xhttp.send();
        
    }
function addMap(directory)
    {    // console.log("here");
        for (var key in jsonData)
       {     //console.log("here");
            if (jsonData.hasOwnProperty(key)) 
            {   //console.log(key);
              
             //myMap.set(key,arraySub);
                if (directory==(key))
               {   var sub=[];
                   var DirectoryList=jsonData[key];
                    for (var b=0;b<DirectoryList.length;b++)
                    {
                        if(!DirectoryList[b].includes(".html"))
                            {  
                              sub.push(DirectoryList[b]);  
                            }
                    }  
                    myMap.set(directory,sub);
                   // add nested subdirectories 
                     // replicate the jsonData iterate data
                    for (var i=0;i<sub.length;i++)
                        {
                            for (var subKey in jsonData)
                                {
                                    if (jsonData.hasOwnProperty(subKey))
                                        {   if (sub[i]==subKey)
                                            {
                                                var subSub=[];
                                                var DirectoryList=jsonData[subKey];
                                            
                                               for (var b=0;b<DirectoryList.length;b++)
                                                    { 
                                                        if(!DirectoryList[b].includes(".html"))
                                                        {  
                                                            subSub.push(DirectoryList[b]);  
                                                        }
                                                    } 
                                                myMap.set(sub[i],subSub);
                                                console.log(myMap.get(sub[i]));
                                            }
                                        }
                                }   
                        }

                    }
            
             
            }  
           
       } 
        createDir(directory);
    }
addDir("/Users/breydenmonyemoratho/Desktop/myEmail/dir.txt");

    
//createDir("rrrrr");
function createDir(dir)
    {    // playing around the map
//        var arr=["ayaya","yebo"];
//        myMap.set(dir, arr);
      //  console.log("here");
        var btn_group = document.getElementById("btn-group");
       
        // create wrapper div
         var wrapper_dir = document.createElement("div");
         wrapper_dir.setAttribute("class","wrapper_dir");
        wrapper_dir.setAttribute("id",dir);
     
/*       create sign and put nothing
        <div class="sign">
            <button><i class="fa fa-chevron-down"></i></button> 
        </div>
*/         
     
     var sign_div = document.createElement("div");
     sign_div.setAttribute("class","sign");
     var sign_button = document.createElement("button");
    sign_button.setAttribute("id",dir);
    sign_button.setAttribute("class","drop_d");
     // create a map 
      
       // assume no sub directories at first right
    
     
     var icon_ = document.createElement("i");
     var arraySub=myMap.get(dir);
     
        if (arraySub.length>0)
            {
                icon_.setAttribute("class","fa fa-angle-up");
            }
        else
            {
               icon_.setAttribute("class","fa fa-angle-double-right"); 
            }
        
      
     //icon_.setAttribute("id","no_drop");
     sign_button.appendChild(icon_);
     sign_div.appendChild(sign_button);
     
     /*   create a dir button
     <button id="All"   class="dir">All</button> */ 
     var button_dir= document.createElement("button");
    button_dir.setAttribute("class","dir");
     button_dir.setAttribute("id",dir);
    var name_dir = document.createElement("p");
     name_dir.appendChild(document.createTextNode(dir)); 
     button_dir.appendChild(name_dir);  // append the name
     
     // add to wrapper
    wrapper_dir.appendChild(sign_div);
     wrapper_dir.appendChild(button_dir);
     
    /*add the dropdown content note: drowdown content is empty initially
    <div class="dropdown-content" "id"=>
             <div class="wrapper_dir">
                    <div class=   "sign">
                        <button><i class="fa fa-chevron-down"></i></button> 
                    </div>
                    <button id="All"   class="dir">All</button>   
            </div>     
    </div>
    */
     var div_drop = document.createElement("div");
     div_drop.setAttribute("class","dropdown-content");
     div_drop.setAttribute("id",dir+"dropdown-content");    
     
  
     btn_group.appendChild(wrapper_dir);
     btn_group.appendChild(div_drop);
 // console.log("here in create div");
    }

// create on click listener for the dropdown button
$("button.drop_d").click(function() {
//console.log(this.id);
var innerNode=this.firstChild;
var classChild=innerNode.className;

    if (classChild=="fa fa-angle-up")
        { //console.log(classChild);
          this.removeChild(innerNode);
          var icon_ = document.createElement("i");
         icon_.setAttribute("class","fa fa-angle-down");
         this.appendChild(icon_);
         // call a method to add all the subdirectories
         addSub(this.id);
            
        }
    if (classChild=="fa fa-angle-down")
        {   // console.log(classChild);
            var div_drop=document.getElementById(this.id+"dropdown-content");
            div_drop.innerHTML="";  // might be affecting my code
            
            // change the symbol back to up
            this.removeChild(innerNode);
          var icon_ = document.createElement("i");
         icon_.setAttribute("class","fa fa-angle-up");
         this.appendChild(icon_);
        
        }
});
function addSub(root)
    {   console.log(root);
        var div_drop=document.getElementById(root+"dropdown-content");
        // get the subdirectories from the Map
        var subList=myMap.get(root);
        var k=0;
         for (k=0;k<subList.length;k++)
       {  // start populating it. with the content
            var subDirName=subList[k];
            var wrap_drop=document.createElement("div");
            wrap_drop.setAttribute("class","wrapper_dir");
           // button for the subdirectories
            var sub_signDiv=document.createElement("div");
            sub_signDiv.setAttribute("class","sign");
            var sub_signButton=document.createElement("button");
            sub_signButton.setAttribute("id",subDirName);
            sub_signButton.setAttribute("class",subDirName);
              sub_signButton.setAttribute("class","drop_d");
            var i=document.createElement("i");
           // check if the subdirectory is not nested
           var SubSubDirList=myMap.get(subList[k]);
           if (SubSubDirList.length>0)
               {
                    i.setAttribute("class","fa fa-angle-up");
                   
                   
               }
            else{
                  i.setAttribute("fa fa-angle-double-right");
               }
           
          // i.setAttribute("class","fa fa-angle-double-right");
             sub_signButton.appendChild(i);
           sub_signDiv.appendChild(sub_signButton);
          wrap_drop.appendChild(sub_signDiv);
          
          
          // actual button with subdirectory name
          var sub_button=document.createElement("button");
          var name_dir = document.createElement("p");
          name_dir.appendChild(document.createTextNode(subDirName)); 
          sub_button.appendChild(name_dir);
          sub_button.setAttribute("class","dir");
          sub_button.setAttribute("id",subDirName);
          wrap_drop.appendChild(sub_button);
          div_drop.appendChild(wrap_drop);
         if (SubSubDirList.length>0)
               {
                   // create a divdrop down for sub directory
                   
                     var div_dropSub = document.createElement("div");
                     div_dropSub.setAttribute("class","dropdown-content");
                     div_dropSub.setAttribute("id",subList[k]+"dropdown-content"); 
                   // add it outside div drop 
                   
                   div_drop.appendChild(div_dropSub);
                  // console.log(subList[k]);
                   
               }
       }
            // console.log(subDirName);
    }
 // root directory clicking
$("button.dir").click(function() {
  
  //document.getElementById("content").innerHTML="wtf";  // add the document to the content 
    //console.log("i didnt know");
//     var myMap = new Map();
//    myMap.set(this.id, arr);
//   var aray= myMap.get(this.id);
//   aray.push("directory2");
//    console.log(myMap.get(this.id)[1]);
  // var innerNode=this.firstChild;
   // var classChild=innerNode.className;
    // console.log(classChild);
});

function addItem(sender_address,email_summary,xml_filePath){
    var ul = document.getElementById("dynamic-list");
    var li = document.createElement("li");
    li.setAttribute("class","listItem");
    li.setAttribute("id",xml_filePath);
    var d = document.createElement("div");
    d.setAttribute("class","emailSummary");
     
    //i
    var i = document.createElement("i");
    i.setAttribute("class","fa fa-user");
    i.setAttribute("style","font-size:24px");
    i.setAttribute("style","margin-right:20px");
    li.appendChild(i);
   
    // sender 
    var sender_ = document.createElement("p");
     sender_.appendChild(document.createTextNode(sender_address));   // add the text
    d.appendChild(sender_);
    // email summary
    var summary= document.createElement("p");
     summary.appendChild(document.createTextNode(email_summary));   // add the text
     d.appendChild(summary);
    
    li.appendChild(d);
    ul.appendChild(li);
  
}

  /// given the file open and call add
function readAdd(filePath){
 
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
    
        var txt=this.responseText;
        parser=new DOMParser();
htmlDoc=parser.parseFromString(txt, "text/html");
 var from =htmlDoc.getElementsByTagName('b');
       //console.log(from.innerHTML);
var s =htmlDoc.getElementsByTagName('pre');
        //console.log(s.innerHTML);
addItem(from[0].innerHTML,s[0].innerHTML,filePath);
       
       console.log(from[0].innerHTML);
         console.log(s[0].innerHTML);
        
    }
  };
  xhttp.open("GET", filePath,true);
  xhttp.send();
  }
    
 // Click on list item handler
  $('#dynamic-list').on('click','li',function(){
  // this.id   filepath
      clickedOpen(this.id);
  });

//window.onload = function(){ 
//    //console.log("dont you cry"); 
//// document.getElementById("All" ).style.backgroundColor = "lightblue";
////   loadDoc("/Users/breydenmonyemoratho/Desktop/myEmail/all.txt");  // initially pass the inbox folder
//};
function clickedOpen(path) {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        //myArr=this.responseText.split("\n");
        var x = document.getElementById("content");  // add the document to the content section
        x.innerHTML=this.responseText;
        console.log(this.responseText);
    }
  };
  xhttp.open("GET", path,true);
  xhttp.send();
}

//var buttons = $("button.dir");
//buttons.click(function(fele) {
//  buttons.css('background-color', 'lightgray');
//  $(this).css('background-color', 'lightblue');
//
//    // assign the content nothing
//    document.getElementById("content").innerHTML="";  // add the document to the content section
//     document.getElementById("dynamic-list").innerHTML=""
//    if (this.id=="Sent")
//        {
//           loadDoc( "/Users/breydenmonyemoratho/Desktop/myEmail/Sent.txt");
//        }
//    if (this.id=="All")
//        {
//           loadDoc( "/Users/breydenmonyemoratho/Desktop/myEmail/all.txt");
//        }
//    //loadDoc(this.id);
//       
//});
//buttons.hover(function(){
//    $(this).css('background-color', 'red');  
//},function(){
//   $(this).css('background-color', 'white');   
//});
</script>

</body>
</html>
